{
    "name": "aws-crt-nodejs",
    "imports": [
        "nodejs"
    ],
    "deps_dir": "deps",
    "hosts": {
        "manylinux": {
            "enabled": false
        }
    },
    "targets": {
        "android": {
            "enabled": false
        },
        "linux": {
            "imports": ["s2n"],
            "x86": {
                "enabled": false
            }
        },
        "windows": {
            "build_env": {
                "AWS_CRT_MEMORY_TRACING": "2"
            },
            "!build_steps": [
                ["npm", "install"]
            ],
            "!test_steps": [
                ["npm", "test"]
            ]
        }
    },
    "upstream": [],
    "downstream": [],
    "pre_build_steps": [
        ["git", "submodule", "update", "--init", "--recursive"]
    ],
    "build_steps": [
        ["npm", "install", "--ignore-scripts"],
        [
            "node", "node_modules/.bin/cmake-js", "compile",
            "--out={build_dir}",
            "--CDCMAKE_PREFIX_PATH={source_dir}/{libcrypto_path}",
            "--CDCMAKE_EXPORT_COMPILE_COMMANDS=ON",
            "-T", "install"
        ],
        ["npm", "run-script", "tsc"]
    ],
    "test_steps": [
        ["env", "AWS_CRT_MEMORY_TRACING=2", "npm", "test"]
    ]
}
